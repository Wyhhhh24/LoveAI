# ğŸ AI èŠå¤©å•†å“æ¨èåŠŸèƒ½ - å‰ç«¯å¯¹æ¥æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **æœ€åæ›´æ–°**: 2025-10-20  
> **é€‚ç”¨æŠ€æœ¯æ ˆ**: Vue3 / Reactï¼ˆä»£ç æä¾› Vue3 ç‰ˆæœ¬ï¼ŒReact å¯å‚è€ƒæ”¹å†™ï¼‰

---

## ğŸ“‹ ç›®å½•

- [1. åŠŸèƒ½æ¦‚è¿°](#1-åŠŸèƒ½æ¦‚è¿°)
- [2. åç«¯æ•°æ®æ ¼å¼](#2-åç«¯æ•°æ®æ ¼å¼)
- [3. å‰ç«¯å®ç°æ–¹æ¡ˆ](#3-å‰ç«¯å®ç°æ–¹æ¡ˆ)
- [4. å®Œæ•´ä»£ç ](#4-å®Œæ•´ä»£ç )
- [5. å¯¹æ¥æ­¥éª¤](#5-å¯¹æ¥æ­¥éª¤)
- [6. æµ‹è¯•æ£€æŸ¥æ¸…å•](#6-æµ‹è¯•æ£€æŸ¥æ¸…å•)
- [7. å¸¸è§é—®é¢˜ FAQ](#7-å¸¸è§é—®é¢˜-faq)

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½è¯´æ˜

åœ¨ AI èŠå¤©å¯¹è¯ä¸­ï¼Œå½“ç”¨æˆ·è¡¨è¾¾è´­ä¹°æ„å›¾æ—¶ï¼ˆå¦‚ï¼š"å¥³æœ‹å‹ç”Ÿæ—¥é€ä»€ä¹ˆï¼Ÿ"ï¼‰ï¼ŒAI ä¼šåœ¨å›å¤ä¸­æ¨èç›¸å…³å•†å“ã€‚å•†å“ä¿¡æ¯ä»¥**å¡ç‰‡å½¢å¼**å±•ç¤ºåœ¨èŠå¤©æ°”æ³¡ä¸­ï¼Œæ”¯æŒï¼š

- âœ… å®æ—¶æµå¼å¯¹è¯ä¸­æ˜¾ç¤ºå•†å“æ¨è
- âœ… å†å²èŠå¤©è®°å½•ä¸­æ˜¾ç¤ºå•†å“æ¨è
- âœ… ç‚¹å‡»å•†å“å¡ç‰‡è·³è½¬åˆ°è´­ä¹°é“¾æ¥
- âœ… å•†å“å›¾ç‰‡å±•ç¤ºï¼ˆæ”¯æŒåŠ è½½å¤±è´¥å ä½å›¾ï¼‰

### 1.2 æ•ˆæœå±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€AI æ¶ˆæ¯æ°”æ³¡ã€‘                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å“ˆå–½ï½æˆ‘èƒ½æ„Ÿå—åˆ°ä½ å¯¹å¥³æœ‹å‹     â”‚  â”‚
â”‚  â”‚ ç”Ÿæ—¥çš„é‡è§†ï¼æ ¹æ®ä½ çš„æƒ…å†µï¼Œ     â”‚  â”‚
â”‚  â”‚ æˆ‘æœ‰ä¸¤ä¸ªæ¨èï¼š                 â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ 1. ã€Šäº²å¯†å…³ç³»ã€‹è¿™æœ¬ä¹¦...       â”‚  â”‚
â”‚  â”‚ 2. æ˜Ÿç©ºæŠ•å½±ç¯...               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                       â”‚
â”‚  â”â”â”â”â”â”â” ğŸ’ ä¸ºä½ æ¨è â”â”â”â”â”â”â”        â”‚
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [å›¾ç‰‡] æ˜Ÿç©ºæŠ•å½±ç¯              â”‚  â”‚
â”‚  â”‚ è¥é€ æµªæ¼«æ°›å›´                   â”‚  â”‚
â”‚  â”‚ Â¥129.00    [ç«‹å³è´­ä¹° â†’]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [å›¾ç‰‡] æƒ…ä¾£æ‰‹é“¾                â”‚  â”‚
â”‚  â”‚ çºªå¿µæ—¥å¿…å¤‡                     â”‚  â”‚
â”‚  â”‚ Â¥89.00     [ç«‹å³è´­ä¹° â†’]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. åç«¯æ•°æ®æ ¼å¼

### 2.1 å®æ—¶æµå¼å¯¹è¯ï¼ˆSSEï¼‰

**æ¥å£**: `POST /api/chat/rag`

**è¯·æ±‚å‚æ•°**:
```json
{
  "message": "å¥³æœ‹å‹ç”Ÿæ—¥é€ä»€ä¹ˆï¼Ÿ",
  "sessionId": "session_xxx",
  "chatId": "chat_xxx"
}
```

**å“åº”æ ¼å¼**: `text/event-stream` (SSE æµå¼è¾“å‡º)

```
data: å“ˆ
data: å–½
data: ï½
data: æˆ‘
data: èƒ½
data: æ„Ÿ
data: å—
data: åˆ°
data: ä½ 
data: å¯¹
data: å¥³
data: æœ‹
data: å‹
...
data: æ¨èä½ é€æ˜Ÿç©ºæŠ•å½±ç¯å“¦ï¼
data: 
data: [PRODUCTS][{"productId":3,"productName":"æ˜Ÿç©ºæŠ•å½±ç¯","category":"ç¤¼ç‰©","description":"è¥é€ æµªæ¼«æ°›å›´","price":129.00,"imageUrl":"https://minio.example.com/star-light.jpg","jumpUrl":"https://taobao.com/item/12345"},{"productId":6,"productName":"æƒ…ä¾£æ‰‹é“¾","category":"ç¤¼ç‰©","description":"çºªå¿µæ—¥å¿…å¤‡","price":89.00,"imageUrl":"https://minio.example.com/bracelet.jpg","jumpUrl":"https://jd.com/item/67890"}][/PRODUCTS]
```

**å…³é”®æ ‡è®°**:
- `[PRODUCTS]...[/PRODUCTS]` - å•†å“æ•°æ®æ ‡è®°
- æ ‡è®°å†…æ˜¯ **JSON æ•°ç»„**ï¼ŒåŒ…å«å•†å“åˆ—è¡¨
- æ ‡è®°å‡ºç°åœ¨æµå¼è¾“å‡ºçš„**æœ€å**

---

### 2.2 å†å²è®°å½•åŠ è½½

**æ¥å£**: `GET /api/chat/history/{sessionId}`

**å“åº”æ ¼å¼**: `application/json`

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "messages": [
      {
        "id": "msg_001",
        "chatId": "chat_xxx",
        "sessionId": "session_xxx",
        "content": "å¥³æœ‹å‹ç”Ÿæ—¥é€ä»€ä¹ˆï¼Ÿ",
        "isAiResponse": false,
        "recommendedProducts": null
      },
      {
        "id": "msg_002",
        "chatId": "chat_xxx",
        "sessionId": "session_xxx",
        "content": "å“ˆå–½ï½æˆ‘èƒ½æ„Ÿå—åˆ°ä½ å¯¹å¥³æœ‹å‹ç”Ÿæ—¥çš„é‡è§†ï¼æ¨èä½ é€æ˜Ÿç©ºæŠ•å½±ç¯å“¦ï¼",
        "isAiResponse": true,
        "recommendedProducts": [
          {
            "productId": 3,
            "productName": "æ˜Ÿç©ºæŠ•å½±ç¯",
            "category": "ç¤¼ç‰©",
            "description": "è¥é€ æµªæ¼«æ°›å›´",
            "price": 129.00,
            "imageUrl": "https://minio.example.com/star-light.jpg",
            "jumpUrl": "https://taobao.com/item/12345"
          },
          {
            "productId": 6,
            "productName": "æƒ…ä¾£æ‰‹é“¾",
            "category": "ç¤¼ç‰©",
            "description": "çºªå¿µæ—¥å¿…å¤‡",
            "price": 89.00,
            "imageUrl": "https://minio.example.com/bracelet.jpg",
            "jumpUrl": "https://jd.com/item/67890"
          }
        ]
      }
    ]
  }
}
```

**å…³é”®å­—æ®µ**:
- `content` - çº¯æ–‡å­—å†…å®¹ï¼ˆ**å·²æ¸…ç†å•†å“æ ‡è®°**ï¼‰
- `recommendedProducts` - å•†å“æ•°ç»„ï¼ˆå¦‚æœæœ‰æ¨èï¼‰
- `isAiResponse` - æ˜¯å¦ä¸º AI å›å¤

---

### 2.3 å•†å“å¯¹è±¡ç»“æ„

```typescript
interface ProductVO {
  productId: number;        // å•†å“ID
  productName: string;      // å•†å“åç§°
  category: string;         // åˆ†ç±»ï¼šä¹¦ç±/ç¤¼ç‰©/è¯¾ç¨‹
  description: string;      // å•†å“æè¿°
  price: number;            // ä»·æ ¼ï¼ˆå•ä½ï¼šå…ƒï¼‰
  imageUrl: string;         // å•†å“å›¾ç‰‡URL
  jumpUrl: string;          // è´­ä¹°è·³è½¬é“¾æ¥ï¼ˆæ·˜å®/äº¬ä¸œ/è‡ªè¥ï¼‰
}
```

---

## 3. å‰ç«¯å®ç°æ–¹æ¡ˆ

### 3.1 æ ¸å¿ƒæ€è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ç»Ÿä¸€æ•°æ®ç»“æ„ï¼ˆä¸ç®¡æ¥æºï¼‰                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  {                                            â”‚
â”‚    id: string,                                â”‚
â”‚    role: 'user' | 'assistant',                â”‚
â”‚    content: string,          // çº¯æ–‡å­—        â”‚
â”‚    products: ProductVO[],    // å•†å“æ•°ç»„      â”‚
â”‚    isStreaming: boolean      // æ˜¯å¦æµå¼ä¸­    â”‚
â”‚  }                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘                    â†‘
         â”‚                    â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
  â”‚ å®æ—¶æµå¼    â”‚       â”‚ å†å²è®°å½•    â”‚
  â”‚ éœ€è¦è§£æ    â”‚       â”‚ ç›´æ¥ä½¿ç”¨    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¤„ç†æµç¨‹

#### **åœºæ™¯ä¸€ï¼šå®æ—¶æµå¼å¯¹è¯**

```
ç”¨æˆ·å‘é€æ¶ˆæ¯
    â†“
åˆ›å»º AI æ¶ˆæ¯å ä½ç¬¦ { content: '', products: [], isStreaming: true }
    â†“
æ¥æ”¶æµå¼æ•°æ®ï¼šfullText += chunk
    â†“
å®æ—¶æ˜¾ç¤ºï¼šaiMsg.content = hideProductMarkers(fullText)
ï¼ˆéšè— [PRODUCTS]...[/PRODUCTS] æ ‡è®°ï¼Œé¿å…é—ªçƒï¼‰
    â†“
æµå¼ç»“æŸï¼šè§£æ extractProductsFromStream(fullText)
    â†“
åˆ†ç¦»æ•°æ®ï¼š
  - aiMsg.content = çº¯æ–‡å­—
  - aiMsg.products = å•†å“æ•°ç»„
  - aiMsg.isStreaming = false
    â†“
ç»„ä»¶æ¸²æŸ“ï¼š
  - Markdown æ¸²æŸ“æ–‡å­—
  - ProductCard æ¸²æŸ“å•†å“
```

#### **åœºæ™¯äºŒï¼šå†å²è®°å½•åŠ è½½**

```
è¯·æ±‚å†å²è®°å½• API
    â†“
åç«¯è¿”å› JSONï¼ˆå·²åŒ…å« recommendedProductsï¼‰
    â†“
ç›´æ¥è½¬æ¢æ ¼å¼ï¼š
  {
    content: msg.content,
    products: msg.recommendedProducts || [],
    isStreaming: false
  }
    â†“
ç»„ä»¶æ¸²æŸ“ï¼ˆå’Œå®æ—¶æµå¼å®Œå…¨ä¸€æ ·ï¼‰
```

---

## 4. å®Œæ•´ä»£ç 

### 4.1 æ¶ˆæ¯è§£æå·¥å…·

**æ–‡ä»¶è·¯å¾„**: `src/utils/messageParser.js`

```javascript
/**
 * ä»æµå¼è¾“å‡ºä¸­æå–å•†å“æ•°æ®
 * @param {string} rawText - åŸå§‹æµå¼æ–‡æœ¬ï¼ˆåŒ…å« [PRODUCTS]...[/PRODUCTS]ï¼‰
 * @returns {{ text: string, products: array }}
 */
export function extractProductsFromStream(rawText) {
  const regex = /\[PRODUCTS\](.*?)\[\/PRODUCTS\]/s;
  const match = rawText.match(regex);
  
  if (!match) {
    return {
      text: rawText,
      products: []
    };
  }
  
  try {
    // æå–å•†å“ JSON
    const productsJson = match[1].trim();
    const products = JSON.parse(productsJson);
    
    // ç§»é™¤å•†å“æ ‡è®°ï¼Œä¿ç•™çº¯æ–‡å­—
    const text = rawText.replace(regex, '').trim();
    
    console.log('âœ… æˆåŠŸè§£æå•†å“', products.length, 'ä¸ª');
    return { text, products };
    
  } catch (error) {
    console.error('âŒ å•†å“æ•°æ®è§£æå¤±è´¥:', error);
    // è§£æå¤±è´¥æ—¶ï¼Œç§»é™¤æ ‡è®°ä½†è¿”å›ç©ºå•†å“åˆ—è¡¨
    return {
      text: rawText.replace(regex, '').trim(),
      products: []
    };
  }
}

/**
 * å®æ—¶æ˜¾ç¤ºæ—¶éšè—å•†å“æ ‡è®°ï¼ˆæµå¼è¾“å‡ºä¸­ï¼‰
 * @param {string} text - å½“å‰ç´¯ç§¯çš„æ–‡æœ¬
 * @returns {string} - æ¸…ç†åçš„æ–‡æœ¬
 */
export function hideProductMarkers(text) {
  return text.replace(/\[PRODUCTS\].*?\[\/PRODUCTS\]/s, '');
}
```

---

### 4.2 èŠå¤©é€»è¾‘ï¼ˆVue3 Composition APIï¼‰

**æ–‡ä»¶è·¯å¾„**: `src/composables/useChatStream.js`

```javascript
import { ref } from 'vue';
import { extractProductsFromStream, hideProductMarkers } from '@/utils/messageParser';

export function useChatStream() {
  const messages = ref([]);
  
  /**
   * å‘é€æ¶ˆæ¯ï¼ˆå®æ—¶æµå¼ï¼‰
   */
  async function sendMessage(userMessage, sessionId, chatId) {
    // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    const userMsg = {
      id: `user_${Date.now()}`,
      role: 'user',
      content: userMessage,
      products: [],
      isStreaming: false
    };
    messages.value.push(userMsg);
    
    // 2. åˆ›å»º AI æ¶ˆæ¯å ä½ç¬¦
    const aiMsg = {
      id: `ai_${Date.now()}`,
      role: 'assistant',
      content: '',
      products: [],
      isStreaming: true
    };
    messages.value.push(aiMsg);
    
    // 3. å‘èµ·æµå¼è¯·æ±‚
    try {
      const response = await fetch('/api/chat/rag', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'text/event-stream'
        },
        body: JSON.stringify({
          message: userMessage,
          sessionId: sessionId,
          chatId: chatId
        })
      });
      
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let fullText = ''; // å®Œæ•´ç´¯ç§¯æ–‡æœ¬ï¼ˆåŒ…å«å•†å“æ ‡è®°ï¼‰
      
      // 4. è¯»å–æµå¼æ•°æ®
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        
        const chunk = decoder.decode(value, { stream: true });
        fullText += chunk;
        
        // âœ… å®æ—¶æ˜¾ç¤ºæ—¶éšè—å•†å“æ ‡è®°ï¼ˆé¿å…é—ªçƒï¼‰
        aiMsg.content = hideProductMarkers(fullText);
      }
      
      // 5. æµå¼ç»“æŸï¼Œè§£ææœ€ç»ˆæ•°æ®
      const parsed = extractProductsFromStream(fullText);
      aiMsg.content = parsed.text;      // âœ… çº¯æ–‡å­—
      aiMsg.products = parsed.products; // âœ… å•†å“æ•°ç»„
      aiMsg.isStreaming = false;        // âœ… æ ‡è®°å®Œæˆ
      
      console.log('âœ… æµå¼è¾“å‡ºå®Œæˆ', {
        æ–‡å­—é•¿åº¦: parsed.text.length,
        å•†å“æ•°é‡: parsed.products.length
      });
      
    } catch (error) {
      console.error('âŒ æµå¼è¯·æ±‚å¤±è´¥:', error);
      aiMsg.content = 'æŠ±æ­‰ï¼Œæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•';
      aiMsg.isStreaming = false;
    }
  }
  
  /**
   * åŠ è½½å†å²è®°å½•
   */
  async function loadHistory(sessionId) {
    try {
      const response = await fetch(`/api/chat/history/${sessionId}`);
      const result = await response.json();
      
      if (result.code !== 200) {
        throw new Error(result.message);
      }
      
      // âœ… åç«¯å·²ç»å¤„ç†å¥½æ•°æ®ï¼Œç›´æ¥è½¬æ¢æ ¼å¼
      messages.value = result.data.messages.map(msg => ({
        id: msg.id,
        role: msg.isAiResponse ? 'assistant' : 'user',
        content: msg.content,                          // âœ… çº¯æ–‡å­—
        products: msg.recommendedProducts || [],       // âœ… å•†å“æ•°ç»„
        isStreaming: false
      }));
      
      console.log('âœ… å†å²è®°å½•åŠ è½½å®Œæˆ', messages.value.length, 'æ¡');
      
    } catch (error) {
      console.error('âŒ åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
    }
  }
  
  return {
    messages,
    sendMessage,
    loadHistory
  };
}
```

---

### 4.3 èŠå¤©æ¶ˆæ¯ç»„ä»¶

**æ–‡ä»¶è·¯å¾„**: `src/components/ChatMessage.vue`

```vue
<template>
  <div class="chat-message" :class="message.role">
    <!-- ç”¨æˆ·æ¶ˆæ¯ -->
    <div v-if="message.role === 'user'" class="message-bubble user-bubble">
      <div class="message-text">{{ message.content }}</div>
    </div>
    
    <!-- AI æ¶ˆæ¯ -->
    <div v-else class="message-bubble ai-bubble">
      <!-- æ–‡å­—å†…å®¹ï¼ˆMarkdown æ¸²æŸ“ï¼‰-->
      <div class="message-text markdown-content" v-html="renderedMarkdown"></div>
      
      <!-- å•†å“å¡ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰-->
      <div v-if="hasProducts" class="product-section">
        <div class="product-divider">
          <span class="product-label">ğŸ’ ä¸ºä½ æ¨è</span>
        </div>
        <div class="product-list">
          <ProductCard 
            v-for="product in message.products" 
            :key="product.productId"
            :product="product"
          />
        </div>
      </div>
      
      <!-- æµå¼è¾“å‡ºå…‰æ ‡ -->
      <span v-if="message.isStreaming" class="typing-cursor">â–Š</span>
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue';
import MarkdownIt from 'markdown-it';
import ProductCard from './ProductCard.vue';

const props = defineProps({
  message: {
    type: Object,
    required: true
  }
});

const md = new MarkdownIt({
  html: false,        // ä¸å…è®¸ HTML æ ‡ç­¾
  linkify: true,      // è‡ªåŠ¨è¯†åˆ«é“¾æ¥
  breaks: true        // æ¢è¡Œè½¬ <br>
});

// æ¸²æŸ“ Markdown
const renderedMarkdown = computed(() => {
  return md.render(props.message.content || '');
});

// æ˜¯å¦æœ‰å•†å“
const hasProducts = computed(() => {
  return props.message.products && props.message.products.length > 0;
});
</script>

<style scoped>
.chat-message {
  margin-bottom: 20px;
  display: flex;
  align-items: flex-start;
}

.chat-message.user {
  justify-content: flex-end;
}

.chat-message.assistant {
  justify-content: flex-start;
}

/* æ°”æ³¡æ ·å¼ */
.message-bubble {
  max-width: 75%;
  padding: 14px 18px;
  border-radius: 16px;
  word-wrap: break-word;
}

.user-bubble {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-bottom-right-radius: 4px;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.ai-bubble {
  background: white;
  color: #333;
  border-bottom-left-radius: 4px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
}

/* æ–‡å­—å†…å®¹ */
.message-text {
  line-height: 1.6;
}

/* Markdown æ ·å¼ */
.markdown-content :deep(p) {
  margin: 0 0 10px 0;
}

.markdown-content :deep(p:last-child) {
  margin-bottom: 0;
}

.markdown-content :deep(strong) {
  font-weight: 600;
  color: #667eea;
}

.markdown-content :deep(code) {
  background: #f5f5f5;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
}

/* å•†å“åŒºåŸŸ */
.product-section {
  margin-top: 16px;
}

.product-divider {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  padding-top: 12px;
  border-top: 1px dashed #e5e5e5;
}

.product-label {
  font-size: 13px;
  color: #999;
  font-weight: 500;
}

.product-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* æµå¼å…‰æ ‡ */
.typing-cursor {
  display: inline-block;
  width: 8px;
  height: 16px;
  background: #667eea;
  margin-left: 2px;
  animation: blink 1s infinite;
  vertical-align: text-bottom;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

/* å“åº”å¼ */
@media (max-width: 768px) {
  .message-bubble {
    max-width: 85%;
  }
}
</style>
```

---

### 4.4 å•†å“å¡ç‰‡ç»„ä»¶

**æ–‡ä»¶è·¯å¾„**: `src/components/ProductCard.vue`

```vue
<template>
  <div class="product-card" @click="handleClick">
    <div class="product-image-wrapper">
      <img 
        :src="product.imageUrl" 
        :alt="product.productName"
        @error="handleImageError"
        class="product-image"
      >
    </div>
    
    <div class="product-info">
      <div class="product-header">
        <h4 class="product-name">{{ product.productName }}</h4>
        <span class="product-category">{{ product.category }}</span>
      </div>
      
      <p class="product-desc">{{ product.description }}</p>
      
      <div class="product-footer">
        <div class="product-price-wrapper">
          <span class="price-symbol">Â¥</span>
          <span class="price-value">{{ formatPrice(product.price) }}</span>
        </div>
        <button class="buy-btn" @click.stop="handleBuy">
          ç«‹å³è´­ä¹°
          <span class="arrow">â†’</span>
        </button>
      </div>
    </div>
  </div>
</template>

<script setup>
const props = defineProps({
  product: {
    type: Object,
    required: true
  }
});

// æ ¼å¼åŒ–ä»·æ ¼
function formatPrice(price) {
  return Number(price).toFixed(2);
}

// å›¾ç‰‡åŠ è½½å¤±è´¥
function handleImageError(event) {
  event.target.src = '/images/product-placeholder.png'; // é»˜è®¤å ä½å›¾
}

// ç‚¹å‡»å¡ç‰‡ï¼ˆæ•´ä½“å¯ç‚¹å‡»ï¼‰
function handleClick() {
  handleBuy();
}

// è´­ä¹°æ“ä½œ
function handleBuy() {
  // æ‰“å¼€å•†å“é“¾æ¥
  window.open(props.product.jumpUrl, '_blank');
  
  // å‘é€åŸ‹ç‚¹ç»Ÿè®¡
  trackProductClick(props.product.productId);
}

// åŸ‹ç‚¹ç»Ÿè®¡
async function trackProductClick(productId) {
  try {
    await fetch('/api/track/product-click', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        productId,
        timestamp: Date.now()
      })
    });
    console.log('âœ… å•†å“ç‚¹å‡»å·²ç»Ÿè®¡:', productId);
  } catch (error) {
    console.error('âŒ åŸ‹ç‚¹ä¸ŠæŠ¥å¤±è´¥:', error);
  }
}
</script>

<style scoped>
.product-card {
  display: flex;
  gap: 12px;
  padding: 12px;
  background: #fafafa;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.product-card:hover {
  background: #f5f5f5;
  border-color: #667eea;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}

.product-image-wrapper {
  flex-shrink: 0;
  width: 80px;
  height: 80px;
  border-radius: 8px;
  overflow: hidden;
  background: white;
}

.product-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.product-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0; /* é˜²æ­¢æ–‡å­—æº¢å‡º */
}

.product-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.product-name {
  font-size: 15px;
  font-weight: 600;
  color: #333;
  margin: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 1;
}

.product-category {
  font-size: 11px;
  padding: 2px 8px;
  background: #667eea;
  color: white;
  border-radius: 10px;
  flex-shrink: 0;
}

.product-desc {
  font-size: 13px;
  color: #666;
  margin: 0 0 10px 0;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  line-height: 1.4;
}

.product-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: auto;
}

.product-price-wrapper {
  display: flex;
  align-items: baseline;
}

.price-symbol {
  font-size: 14px;
  color: #ff3b30;
  font-weight: 600;
}

.price-value {
  font-size: 20px;
  font-weight: bold;
  color: #ff3b30;
  margin-left: 2px;
}

.buy-btn {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 14px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.buy-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
}

.buy-btn .arrow {
  transition: transform 0.2s;
}

.buy-btn:hover .arrow {
  transform: translateX(2px);
}

@media (max-width: 768px) {
  .product-card {
    padding: 10px;
  }
  
  .product-image-wrapper {
    width: 70px;
    height: 70px;
  }
  
  .product-name {
    font-size: 14px;
  }
  
  .price-value {
    font-size: 18px;
  }
}
</style>
```

---

### 4.5 é¡µé¢ä½¿ç”¨ç¤ºä¾‹

**æ–‡ä»¶è·¯å¾„**: `src/pages/Chat.vue`

```vue
<template>
  <div class="chat-page">
    <div class="chat-header">
      <h2>AI æ‹çˆ±é¡¾é—®</h2>
    </div>
    
    <div class="chat-content" ref="chatContainer">
      <ChatMessage 
        v-for="msg in messages" 
        :key="msg.id"
        :message="msg"
      />
    </div>
    
    <div class="chat-input-wrapper">
      <input 
        v-model="inputText"
        @keypress.enter="handleSend"
        placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
        class="chat-input"
      >
      <button @click="handleSend" class="send-btn">å‘é€</button>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, nextTick } from 'vue';
import { useChatStream } from '@/composables/useChatStream';
import ChatMessage from '@/components/ChatMessage.vue';

const { messages, sendMessage, loadHistory } = useChatStream();
const inputText = ref('');
const chatContainer = ref(null);

// ä»è·¯ç”±æˆ–çŠ¶æ€ç®¡ç†è·å–
const sessionId = 'your-session-id'; 
const chatId = 'your-chat-id';

// é¡µé¢åŠ è½½æ—¶è·å–å†å²è®°å½•
onMounted(async () => {
  await loadHistory(sessionId);
  scrollToBottom();
});

// å‘é€æ¶ˆæ¯
async function handleSend() {
  if (!inputText.value.trim()) return;
  
  const message = inputText.value.trim();
  inputText.value = '';
  
  await sendMessage(message, sessionId, chatId);
  await nextTick();
  scrollToBottom();
}

// æ»šåŠ¨åˆ°åº•éƒ¨
function scrollToBottom() {
  if (chatContainer.value) {
    chatContainer.value.scrollTop = chatContainer.value.scrollHeight;
  }
}
</script>

<style scoped>
.chat-page {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: #f5f5f7;
}

.chat-header {
  padding: 16px 20px;
  background: white;
  border-bottom: 1px solid #e5e5e5;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.chat-header h2 {
  margin: 0;
  font-size: 18px;
  color: #333;
}

.chat-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.chat-input-wrapper {
  display: flex;
  gap: 10px;
  padding: 16px 20px;
  background: white;
  border-top: 1px solid #e5e5e5;
}

.chat-input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid #ddd;
  border-radius: 24px;
  font-size: 14px;
  outline: none;
  transition: border-color 0.2s;
}

.chat-input:focus {
  border-color: #667eea;
}

.send-btn {
  padding: 12px 28px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 24px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: opacity 0.2s;
}

.send-btn:hover {
  opacity: 0.9;
}
</style>
```

---

## 5. å¯¹æ¥æ­¥éª¤

### 5.1 ç¯å¢ƒå‡†å¤‡

**å®‰è£…ä¾èµ–**:

```bash
# Vue3
npm install markdown-it

# React
npm install markdown-it react-markdown
```

---

### 5.2 é›†æˆæ­¥éª¤

#### **æ­¥éª¤ 1ï¼šå¤åˆ¶å·¥å…·å‡½æ•°**

å¤åˆ¶ `messageParser.js` åˆ°ä½ çš„ `src/utils/` ç›®å½•ã€‚

#### **æ­¥éª¤ 2ï¼šå¤åˆ¶é€»è¾‘å¤ç”¨**

å¤åˆ¶ `useChatStream.js` åˆ°ä½ çš„ `src/composables/` æˆ– `src/hooks/` ç›®å½•ã€‚

#### **æ­¥éª¤ 3ï¼šå¤åˆ¶ç»„ä»¶**

å¤åˆ¶ä»¥ä¸‹ç»„ä»¶åˆ°ä½ çš„ `src/components/` ç›®å½•ï¼š
- `ChatMessage.vue`
- `ProductCard.vue`

#### **æ­¥éª¤ 4ï¼šä¿®æ”¹ API åœ°å€**

åœ¨ `useChatStream.js` ä¸­ä¿®æ”¹ï¼š

```javascript
// ä¿®æ”¹ä¸ºä½ çš„åç«¯åœ°å€
const response = await fetch('http://your-backend-url/api/chat/rag', {
  // ...
});

// ä¿®æ”¹ä¸ºä½ çš„åç«¯åœ°å€
const response = await fetch(`http://your-backend-url/api/chat/history/${sessionId}`);
```

#### **æ­¥éª¤ 5ï¼šè·å– sessionId å’Œ chatId**

æ ¹æ®ä½ çš„é¡¹ç›®ï¼Œä»è·¯ç”±æˆ–çŠ¶æ€ç®¡ç†è·å–ï¼š

```javascript
// ç¤ºä¾‹ 1ï¼šä» URL å‚æ•°
import { useRoute } from 'vue-router';
const route = useRoute();
const sessionId = route.params.sessionId;

// ç¤ºä¾‹ 2ï¼šä» Vuex/Pinia
import { useStore } from 'vuex';
const store = useStore();
const sessionId = store.state.currentSessionId;

// ç¤ºä¾‹ 3ï¼šä» localStorage
const sessionId = localStorage.getItem('sessionId');
```

#### **æ­¥éª¤ 6ï¼šå‡†å¤‡å ä½å›¾**

åœ¨ `public/images/` ç›®å½•ä¸‹æ”¾ç½® `product-placeholder.png` ä½œä¸ºå•†å“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„å ä½å›¾ã€‚

#### **æ­¥éª¤ 7ï¼šæµ‹è¯•**

1. æµ‹è¯•å®æ—¶æµå¼å¯¹è¯ï¼ˆæœ‰å•†å“æ¨èï¼‰
2. æµ‹è¯•å®æ—¶æµå¼å¯¹è¯ï¼ˆæ— å•†å“æ¨èï¼‰
3. æµ‹è¯•å†å²è®°å½•åŠ è½½ï¼ˆæœ‰å•†å“ï¼‰
4. æµ‹è¯•å†å²è®°å½•åŠ è½½ï¼ˆæ— å•†å“ï¼‰

---

## 6. æµ‹è¯•æ£€æŸ¥æ¸…å•

### 6.1 åŠŸèƒ½æµ‹è¯•

- [ ] **å®æ—¶å¯¹è¯ - æœ‰å•†å“æ¨è**
  - [ ] æ–‡å­—é€å­—æ˜¾ç¤ºæ­£å¸¸
  - [ ] å•†å“æ ‡è®°ä¸å¯è§ï¼ˆæµå¼è¾“å‡ºæ—¶ï¼‰
  - [ ] æµå¼ç»“æŸåå•†å“å¡ç‰‡æ­£å¸¸æ˜¾ç¤º
  - [ ] å•†å“æ•°é‡æ­£ç¡®

- [ ] **å®æ—¶å¯¹è¯ - æ— å•†å“æ¨è**
  - [ ] æ–‡å­—æ­£å¸¸æ˜¾ç¤º
  - [ ] ä¸æ˜¾ç¤ºå•†å“åˆ†å‰²çº¿
  - [ ] ä¸æ˜¾ç¤ºå•†å“å¡ç‰‡

- [ ] **å†å²è®°å½•åŠ è½½**
  - [ ] ç”¨æˆ·æ¶ˆæ¯æ­£å¸¸æ˜¾ç¤º
  - [ ] AI æ¶ˆæ¯æ–‡å­—æ­£å¸¸æ˜¾ç¤º
  - [ ] å•†å“å¡ç‰‡æ­£å¸¸æ˜¾ç¤ºï¼ˆå¦‚æœæœ‰ï¼‰
  - [ ] æ¶ˆæ¯é¡ºåºæ­£ç¡®

- [ ] **å•†å“å¡ç‰‡åŠŸèƒ½**
  - [ ] å•†å“å›¾ç‰‡æ­£å¸¸åŠ è½½
  - [ ] å›¾ç‰‡åŠ è½½å¤±è´¥æ˜¾ç¤ºå ä½å›¾
  - [ ] ç‚¹å‡»å¡ç‰‡è·³è½¬åˆ°è´­ä¹°é“¾æ¥
  - [ ] æ–°çª—å£æ‰“å¼€é“¾æ¥
  - [ ] å•†å“ä»·æ ¼æ ¼å¼æ­£ç¡®ï¼ˆä¿ç•™ä¸¤ä½å°æ•°ï¼‰

- [ ] **Markdown æ¸²æŸ“**
  - [ ] æ®µè½æ­£å¸¸æ˜¾ç¤º
  - [ ] åŠ ç²—æ–‡å­—æ­£å¸¸
  - [ ] ä»£ç å—æ­£å¸¸
  - [ ] é“¾æ¥å¯ç‚¹å‡»

### 6.2 æ ·å¼æµ‹è¯•

- [ ] **PC ç«¯**
  - [ ] ç”¨æˆ·æ¶ˆæ¯å³ä¾§å¯¹é½ï¼Œè“è‰²æ°”æ³¡
  - [ ] AI æ¶ˆæ¯å·¦ä¾§å¯¹é½ï¼Œç™½è‰²æ°”æ³¡
  - [ ] å•†å“å¡ç‰‡å¸ƒå±€æ­£å¸¸
  - [ ] Hover æ•ˆæœæ­£å¸¸

- [ ] **ç§»åŠ¨ç«¯**
  - [ ] æ°”æ³¡å®½åº¦è‡ªé€‚åº”
  - [ ] å•†å“å¡ç‰‡ä¸æº¢å‡º
  - [ ] æŒ‰é’®å¤§å°åˆé€‚
  - [ ] å­—ä½“å¤§å°é€‚ä¸­

### 6.3 æ€§èƒ½æµ‹è¯•

- [ ] é•¿æ–‡æœ¬æ¸²æŸ“ä¸å¡é¡¿
- [ ] å¤šå•†å“å¡ç‰‡æ¸²æŸ“æµç•…
- [ ] æ»šåŠ¨æµç•…
- [ ] å†å²è®°å½•åŠ è½½å¿«é€Ÿ

### 6.4 å¼‚å¸¸æµ‹è¯•

- [ ] ç½‘ç»œé”™è¯¯æç¤ºæ­£å¸¸
- [ ] å•†å“ JSON è§£æå¤±è´¥ä¸å½±å“æ–‡å­—æ˜¾ç¤º
- [ ] å›¾ç‰‡åŠ è½½å¤±è´¥æ˜¾ç¤ºå ä½å›¾
- [ ] åŸ‹ç‚¹ä¸ŠæŠ¥å¤±è´¥ä¸å½±å“åŠŸèƒ½

---

## 7. å¸¸è§é—®é¢˜ FAQ

### Q1: å•†å“æ ‡è®°åœ¨æµå¼è¾“å‡ºæ—¶é—ªçƒæ€ä¹ˆåŠï¼Ÿ

**A:** ä»£ç ä¸­å·²ä½¿ç”¨ `hideProductMarkers()` å‡½æ•°å®æ—¶éšè—æ ‡è®°ï¼Œç¡®ä¿æµå¼è¾“å‡ºæ—¶è°ƒç”¨ï¼š

```javascript
// âœ… æ­£ç¡®
aiMsg.content = hideProductMarkers(fullText);

// âŒ é”™è¯¯
aiMsg.content = fullText; // ä¼šæ˜¾ç¤º [PRODUCTS]...
```

---

### Q2: Markdown è§£æå™¨æŠŠ `[PRODUCTS]` å½“æˆé“¾æ¥ï¼Ÿ

**A:** åœ¨è§£æ Markdown **ä¹‹å‰**å…ˆæå–å•†å“æ•°æ®ï¼š

```javascript
// âœ… æ­£ç¡®é¡ºåº
const parsed = extractProductsFromStream(fullText);  // 1ï¸âƒ£ å…ˆæå–
const html = md.render(parsed.text);                 // 2ï¸âƒ£ å†æ¸²æŸ“

// âŒ é”™è¯¯é¡ºåº
const html = md.render(fullText);  // Markdown ä¼šå¤„ç† [PRODUCTS]
```

---

### Q3: å†å²è®°å½•ä¸­å•†å“æ•°æ®ä¸ºç©ºï¼Ÿ

**A:** æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®è¿”å› `recommendedProducts` å­—æ®µï¼Œç¡®ä¿ï¼š

```javascript
// åç«¯è¿”å›æ ¼å¼
{
  "content": "æ–‡å­—å†…å®¹",
  "recommendedProducts": [...] // âœ… å¿…é¡»åŒ…å«æ­¤å­—æ®µ
}

// å‰ç«¯å¤„ç†
products: msg.recommendedProducts || []  // âœ… ç©ºå€¼ä¿æŠ¤
```

---

### Q4: å•†å“å›¾ç‰‡åŠ è½½å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** ä»£ç ä¸­å·²å¤„ç†ï¼Œç¡®ä¿å‡†å¤‡å ä½å›¾ï¼š

```javascript
function handleImageError(event) {
  event.target.src = '/images/product-placeholder.png'; // æ›¿æ¢ä¸ºé»˜è®¤å›¾
}
```

**å ä½å›¾å‡†å¤‡**ï¼š
1. åœ¨ `public/images/` ç›®å½•ä¸‹æ”¾ç½® `product-placeholder.png`
2. æˆ–ä½¿ç”¨åœ¨çº¿å ä½å›¾æœåŠ¡ï¼š`https://via.placeholder.com/80`

---

### Q5: å¦‚ä½•ç»Ÿè®¡å•†å“ç‚¹å‡»ï¼Ÿ

**A:** ä»£ç ä¸­å·²å®ç° `trackProductClick()` å‡½æ•°ï¼Œåç«¯éœ€æä¾›ç»Ÿè®¡æ¥å£ï¼š

```javascript
// å‰ç«¯å‘é€
POST /api/track/product-click
{
  "productId": 3,
  "timestamp": 1697890123456
}

// åç«¯è®°å½•ç‚¹å‡»æ•°æ®
```

---

### Q6: å¦‚ä½•é€‚é… Reactï¼Ÿ

**A:** æ ¸å¿ƒé€»è¾‘ç›¸åŒï¼Œä¸»è¦åŒºåˆ«ï¼š

```jsx
// Vue3
const { messages, sendMessage } = useChatStream();

// React
import { useState, useEffect } from 'react';
const [messages, setMessages] = useState([]);
```

**React Hook ç¤ºä¾‹**:

```javascript
// hooks/useChatStream.js
import { useState } from 'react';
import { extractProductsFromStream, hideProductMarkers } from '@/utils/messageParser';

export function useChatStream() {
  const [messages, setMessages] = useState([]);
  
  async function sendMessage(userMessage, sessionId, chatId) {
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    setMessages(prev => [...prev, {
      id: `user_${Date.now()}`,
      role: 'user',
      content: userMessage,
      products: [],
      isStreaming: false
    }]);
    
    // åˆ›å»º AI æ¶ˆæ¯å ä½ç¬¦
    const aiMsgId = `ai_${Date.now()}`;
    setMessages(prev => [...prev, {
      id: aiMsgId,
      role: 'assistant',
      content: '',
      products: [],
      isStreaming: true
    }]);
    
    // æµå¼è¯·æ±‚...
    const response = await fetch('/api/chat/rag', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: userMessage, sessionId, chatId })
    });
    
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let fullText = '';
    
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      
      const chunk = decoder.decode(value, { stream: true });
      fullText += chunk;
      
      // æ›´æ–°æ¶ˆæ¯å†…å®¹
      setMessages(prev => prev.map(msg => 
        msg.id === aiMsgId 
          ? { ...msg, content: hideProductMarkers(fullText) }
          : msg
      ));
    }
    
    // æµå¼ç»“æŸï¼Œè§£æå•†å“
    const parsed = extractProductsFromStream(fullText);
    setMessages(prev => prev.map(msg => 
      msg.id === aiMsgId 
        ? { ...msg, content: parsed.text, products: parsed.products, isStreaming: false }
        : msg
    ));
  }
  
  return { messages, sendMessage };
}
```

---

### Q7: å¦‚ä½•è‡ªå®šä¹‰å•†å“å¡ç‰‡æ ·å¼ï¼Ÿ

**A:** ä¿®æ”¹ `ProductCard.vue` çš„ `<style>` éƒ¨åˆ†ï¼š

```css
/* ä¿®æ”¹é…è‰² */
.buy-btn {
  background: linear-gradient(135deg, #your-color1 0%, #your-color2 100%);
}

/* ä¿®æ”¹å¸ƒå±€ */
.product-card {
  flex-direction: column; /* ä¸Šä¸‹å¸ƒå±€ */
}

/* ä¿®æ”¹å°ºå¯¸ */
.product-image-wrapper {
  width: 120px;  /* æ›´å¤§çš„å›¾ç‰‡ */
  height: 120px;
}
```

---

### Q8: å¦‚ä½•æ”¯æŒæ›´å¤šå¡ç‰‡ç±»å‹ï¼ˆä¼˜æƒ åˆ¸ã€è¯¾ç¨‹ç­‰ï¼‰ï¼Ÿ

**A:** æ‰©å±•æ•°æ®ç»“æ„ï¼š

```javascript
// æ¶ˆæ¯ç»“æ„
{
  content: "æ–‡å­—å†…å®¹",
  products: [...],      // å•†å“å¡ç‰‡
  coupons: [...],       // ä¼˜æƒ åˆ¸å¡ç‰‡
  courses: [...],       // è¯¾ç¨‹å¡ç‰‡
  cardType: "product"   // å¡ç‰‡ç±»å‹æ ‡è¯†
}

// ç»„ä»¶ä¸­æ¡ä»¶æ¸²æŸ“
<ProductCard v-if="message.cardType === 'product'" />
<CouponCard v-if="message.cardType === 'coupon'" />
<CourseCard v-if="message.cardType === 'course'" />
```

---

## 8. æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼

- **åç«¯å¼€å‘**: [ä½ çš„è”ç³»æ–¹å¼]
- **æ–‡æ¡£ç»´æŠ¤**: [ä½ çš„è”ç³»æ–¹å¼]
- **é—®é¢˜åé¦ˆ**: [GitHub Issues / é’‰é’‰ç¾¤ / é‚®ç®±]

### æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| v1.0 | 2025-10-20 | åˆç‰ˆå‘å¸ƒ |

---

## 9. é™„å½•

### 9.1 å®Œæ•´æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ messageParser.js        # æ¶ˆæ¯è§£æå·¥å…·
â”œâ”€â”€ composables/                # Vue3
â”‚   â””â”€â”€ useChatStream.js        # èŠå¤©é€»è¾‘å¤ç”¨
â”œâ”€â”€ hooks/                      # React
â”‚   â””â”€â”€ useChatStream.js        # èŠå¤©é€»è¾‘å¤ç”¨
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ChatMessage.vue         # æ¶ˆæ¯ç»„ä»¶
â”‚   â””â”€â”€ ProductCard.vue         # å•†å“å¡ç‰‡ç»„ä»¶
â””â”€â”€ pages/
    â””â”€â”€ Chat.vue                # èŠå¤©é¡µé¢

public/
â””â”€â”€ images/
    â””â”€â”€ product-placeholder.png # å•†å“å ä½å›¾
```

### 9.2 ä¾èµ–ç‰ˆæœ¬

```json
{
  "dependencies": {
    "vue": "^3.3.0",
    "markdown-it": "^13.0.0"
  }
}
```

---

## ğŸ‰ æ€»ç»“

**æ ¸å¿ƒæ–¹æ¡ˆ**ï¼šåˆ†ç¦»æ¸²æŸ“ + ç»Ÿä¸€æ•°æ®ç»“æ„

**å…³é”®æ­¥éª¤**ï¼š
1. âœ… æµå¼è¾“å‡ºæ—¶æå–å¹¶éšè—å•†å“æ ‡è®°
2. âœ… æµå¼ç»“æŸåè§£æå•†å“æ•°æ®
3. âœ… å†å²è®°å½•ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„å•†å“æ•°æ®
4. âœ… ç»„ä»¶ç»Ÿä¸€æ¸²æŸ“ï¼Œä¸å…³å¿ƒæ•°æ®æ¥æº

**ä¼˜åŠ¿**ï¼š
- ç®€å•å¯é ï¼Œä¸ä¾èµ–å¤æ‚é…ç½®
- æ ·å¼å®Œå…¨å¯æ§
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•
- é€‚é…æ‰€æœ‰ Markdown åº“

å¦‚æœ‰é—®é¢˜ï¼Œè¯·éšæ—¶è”ç³»åç«¯å¼€å‘ï¼ğŸš€

