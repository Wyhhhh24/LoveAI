- **接口数量**: 2 个
- **认证方式**: Session (基于Redis)
- **接口路径前缀**: `/api/love`

---

## 🎯 功能概述

本文档包含两个会话删除相关的接口：

1. **删除会话** (`/deleteChatSession`): 完全删除会话，包括会话记录和所有聊天消息
2. **清空会话消息** (`/deleteChatSessionBySessionId`): 只删除聊天消息，保留会话本身

---

## 📡 接口清单

| 接口名称 | 接口路径 | 请求方法 | 功能描述 | 是否需要登录 |
|---------|---------|---------|---------|-------------|
| 删除会话 | `/love/deleteChatSession` | POST | 完全删除会话及其所有消息 | ✅ 是 |
| 清空会话消息 | `/love/deleteChatSessionBySessionId` | POST | 清空会话消息，保留会话本身 | ✅ 是 |

---

## 📝 接口详细说明

---

## 1. 删除会话

### 接口信息

**接口路径**: `POST /api/love/deleteChatSession`

**功能说明**: 
- 完全删除指定的会话，包括会话记录和该会话下的所有聊天消息
- 删除操作**不可逆**，删除后无法恢复
- 只能删除属于当前登录用户的会话（自动进行权限校验）
- 适用于用户想要彻底删除某个对话的场景

**认证要求**: 
- ✅ 需要登录（`@LoginCheck` 注解）
- ✅ 自动校验会话所有权，防止越权删除

---

### 请求参数

#### Headers
```http
Content-Type: application/json
Cookie: SESSION=your-session-id
```

#### Request Body
```json
{
  "sessionId": "1729065600000_23034480211"
}
```

#### 参数说明

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| `sessionId` | String | ✅ 是 | 要删除的会话ID | `"1729065600000_23034480211"` |

---

### 响应结果

#### 成功响应（删除成功）

**HTTP状态码**: `200 OK`

```json
{
  "code": 0,
  "data": true,
  "message": "ok"
}
```

**字段说明**:
- `code`: 响应码，0 表示成功
- `data`: 删除结果，`true` 表示删除成功
- `message`: 响应消息

```

### 错误码说明

| 错误码 | 说明 | 前端处理建议 |
|--------|------|-------------|
| `0` | 成功 | 更新UI，移除会话 |
| `40000` | 参数错误/无权限 | 提示用户，刷新会话列表 |
| `40100` | 未登录/删除失败 | 跳转登录页或提示重试 |
| `50000` | 系统异常 | 提示稍后重试 |

---

### 注意事项

#### ⚠️ 重要提示

1. **不可逆操作**
   - 删除操作不可恢复
   - 建议前端添加二次确认弹窗
   - 可以在弹窗中显示会话名称和消息数量

2. **权限校验**
   - 后端自动校验会话所有权
   - 前端无需额外校验
   - 即使前端绕过校验，后端也会拦截


4. **UI 更新**
   - 删除成功后立即更新前端会话列表
   - 如果删除的是当前会话，需要切换到其他会话
   - 如果没有其他会话，需要创建新会话或显示空状态

---

## 2. 清空会话消息

### 接口信息

**接口路径**: `POST /api/love/deleteChatSessionBySessionId`

**功能说明**: 
- 清空指定会话中的所有聊天消息
- **保留会话本身**，会话仍然在会话列表中显示
- 清空后可以继续在该会话中发送新消息
- 适用于用户想要清空聊天记录但保留会话的场景

**认证要求**: 
- ✅ 需要登录（`@LoginCheck` 注解）
- ✅ 自动校验会话所有权

---

### 请求参数

#### Headers
```http
Content-Type: application/json
Cookie: SESSION=your-session-id
```

#### Request Body
```json
{
  "sessionId": "1729065600000_23034480211"
}
```

#### 参数说明

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| `sessionId` | String | ✅ 是 | 要清空消息的会话ID | `"1729065600000_23034480211"` |

---

### 响应结果

#### 成功响应

##### 情况1：清空了消息

**场景**: 会话中有消息，成功清空

```json
{
  "code": 0,
  "data": true,
  "message": "ok"
}
```

##### 情况2：会话本来就是空的

**场景**: 会话中没有消息

```json
{
  "code": 0,
  "data": true,
  "message": "ok"
}
```

**说明**: 两种情况都返回成功，前端无需区分

---

#### 失败响应

##### 情况1：参数为空

```json
{
  "code": 40000,
  "data": null,
  "message": "请选择会话"
}
```

##### 情况2：会话不存在或无权限

```json
{
  "code": 40000,
  "data": null,
  "message": "当前用户不存在该会话"
}
```

##### 情况3：未登录

```json
{
  "code": 40100,
  "data": null,
  "message": "未登录"
}
```

##### 情况4：系统异常

```json
{
  "code": 50000,
  "data": null,
  "message": "系统错误"
}


---

### 与"删除会话"的区别

| 对比项 | 删除会话 | 清空消息 |
|--------|---------|---------|
| **会话列表** | 会话消失 ✅ | 会话保留 ✅ |
| **聊天消息** | 全部删除 ✅ | 全部删除 ✅ |
| **可否恢复** | 不可恢复 ❌ | 不可恢复 ❌ |
| **后续操作** | 需创建新会话 | 可继续在该会话中聊天 ✅ |
| **使用场景** | 彻底删除不需要的会话 | 清空聊天记录但保留会话 |

---

### 注意事项

#### ⚠️ 重要提示

1. **会话保留**
   - 清空后会话仍在列表中
   - 会话名称不变
   - 可以继续在该会话中发送新消息

2. **不可恢复**
   - 清空操作同样不可恢复
   - 建议前端添加二次确认

3. **UI 处理**
   - 清空成功后，如果是当前会话，需要清空聊天界面
   - 会话列表中该会话不消失

4. **使用场景**
   - 用户想清空聊天记录重新开始
   - 保留会话名称和分类
   - 不想影响会话列表的组织结构

---

### 测试用例

#### 用例1：清空有消息的会话

**前置条件**: 会话中有多条聊天消息

**测试步骤**:
1. 选择一个有消息的会话
2. 点击清空按钮
3. 确认清空

**预期结果**:
- ✅ 接口返回 `code: 0`
- ✅ 会话仍在列表中
- ✅ 聊天记录被清空
- ✅ 可以继续发送新消息

---

#### 用例2：清空空会话

**前置条件**: 新创建的会话，没有任何消息

**测试步骤**:
1. 选择一个空会话
2. 点击清空按钮

**预期结果**:
- ✅ 接口返回 `code: 0`
- ✅ 不报错
- ✅ 会话状态不变

---

#### 用例3：清空当前会话

**前置条件**: 用户正在某个会话中查看聊天记录

**测试步骤**:
1. 清空当前会话
2. 确认清空

**预期结果**:
- ✅ 接口返回 `code: 0`
- ✅ 聊天界面清空
- ✅ 可以继续发送新消息
- ✅ 会话仍在列表中

---

## 📊 接口对比总结

| 功能 | 删除会话 | 清空消息 |
|------|---------|---------|
| **接口路径** | `/deleteChatSession` | `/deleteChatSessionBySessionId` |
| **删除会话记录** | ✅ 是 | ❌ 否 |
| **删除聊天消息** | ✅ 是 | ✅ 是 |
| **会话列表** | 移除会话 | 保留会话 |
| **后续操作** | 需创建新会话 | 可继续聊天 |
| **使用场景** | 彻底删除 | 清空重新开始 |
| **二次确认** | 强烈建议 | 建议 |

---

## 🔐 安全机制

### 1. 登录认证

- 两个接口都需要登录（`@LoginCheck`）
- Session 基于 Redis，30天有效期
- Session 过期后返回 `40100` 错误码

### 2. 权限校验

- 自动校验会话所有权
- 用户只能操作自己的会话
- 防止越权删除/清空

### 3. 参数校验

- `sessionId` 不能为空
- 会话必须存在
- 会话必须属于当前用户

---

## 🧪 测试建议

### Postman 测试步骤

#### 1. 获取 Session

```http
POST /api/user/login
Content-Type: application/json

{
  "userAccount": "your-account",
  "userPassword": "your-password"
}
```

保存响应中的 `Set-Cookie` 中的 `SESSION` 值。

---

#### 2. 测试删除会话

```http
POST /api/love/deleteChatSession
Content-Type: application/json
Cookie: SESSION=your-session-id

{
  "sessionId": "1729065600000_23034480211"
}
```

---

#### 3. 测试清空消息

```http
POST /api/love/deleteChatSessionBySessionId
Content-Type: application/json
Cookie: SESSION=your-session-id

{
  "sessionId": "1729065600000_23034480211"
}
```

