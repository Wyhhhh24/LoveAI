# 用户登录状态检查接口文档

## 接口信息

**接口名称：** 获取当前登录用户状态

**接口描述：** 检查用户的登录状态是否有效，用于前端验证用户登录态是否过期

**请求路径：** `/loveai/user/getLoginUser`

**请求方法：** `GET`

**接口作用：** 每次进入页面的时候，调用此接口验证后端 Session 中是否还保存着用户登录信息。如果返回 false，前端应清理本地存储的用户信息。

---

## 请求参数

**Query 参数：** 无

**Body 参数：** 无

**Header 参数：** 
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Cookie | String | 是 | 需要携带 Session Cookie，用于后端识别用户身份 |

---

## 响应参数

**响应格式：** JSON

**响应体结构：**
```json
{
    "code": 0,
    "data": true,
    "message": "ok"
}
```

**响应参数说明：**

| 参数名 | 类型 | 说明 |
|--------|------|------|
| code | Integer | 状态码，0 表示成功 |
| data | Boolean | 登录状态，true-已登录，false-未登录或登录已过期 |
| message | String | 响应消息 |

---

## 响应示例

### 成功响应 - 用户已登录
```json
{
    "code": 0,
    "data": true,
    "message": "ok"
}
```

### 成功响应 - 用户未登录或登录已过期
```json
{
    "code": 0,
    "data": false,
    "message": "ok"
}
```

---

## 错误码说明

本接口正常情况下不会返回错误，始终返回 code=0，通过 data 字段判断登录状态。

---

## 调用说明

### 前端调用示例

**JavaScript (Axios):**
```javascript
// 检查用户登录状态
async function checkLoginStatus() {
    try {
        const response = await axios.get('/loveai/user/getLoginUser', {
            withCredentials: true  // 重要：需要携带 Cookie
        });
        
        if (response.data.code === 0) {
            if (response.data.data === false) {
                // 登录已过期，清理本地用户信息
                localStorage.removeItem('userInfo');
                sessionStorage.removeItem('userInfo');
                // 跳转到登录页
                window.location.href = '/login';
            } else {
                // 用户仍在登录状态
                console.log('用户登录状态有效');
            }
        }
    } catch (error) {
        console.error('检查登录状态失败:', error);
    }
}
```

**TypeScript (Fetch):**
```typescript
interface BaseResponse<T> {
    code: number;
    data: T;
    message: string;
}

async function checkLoginStatus(): Promise<boolean> {
    try {
        const response = await fetch('/loveai/user/getLoginUser', {
            method: 'GET',
            credentials: 'include'  // 携带 Cookie
        });
        
        const result: BaseResponse<boolean> = await response.json();
        
        if (result.code === 0) {
            if (!result.data) {
                // 清理本地存储
                localStorage.clear();
                // 重定向到登录页
                window.location.href = '/login';
            }
            return result.data;
        }
        
        return false;
    } catch (error) {
        console.error('检查登录状态异常:', error);
        return false;
    }
}
```

### 后端测试示例

**cURL 命令：**
```bash
# 携带 Cookie 测试
curl -X GET "http://localhost:8123/api/loveai/user/getLoginUser" \
     -H "Cookie: JSESSIONID=your-session-id" \
     -H "Content-Type: application/json"
```


## 使用场景

1. **页面刷新时验证：** 用户刷新页面时，前端从 localStorage 读取用户信息前，先调用此接口验证登录态是否有效

---

## 注意事项

1. **Cookie 携带：** 前端必须在请求中携带 Cookie（withCredentials: true 或 credentials: 'include'）
2. **跨域配置：** 如果前后端分离部署，需要在后端配置 CORS 允许携带凭证
3. **Session 过期时间：** 接口返回 false 表示 Session 中没有用户信息，可能是未登录或 Session 已过期
4. **安全性：** 此接口依赖 Session 机制，请确保 Session 配置合理（如过期时间、HttpOnly 等）

